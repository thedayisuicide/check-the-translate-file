<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>SRT Translator Tool</title>

<style>
body {
    font-family: Arial, sans-serif;
    padding: 20px;
    max-width: 900px;
    margin: auto;
}

.editor {
    display: flex;
    border: 1px solid #ccc;
    height: 320px;
    font-family: Consolas, monospace;
    font-size: 14px;
    line-height: 1.6;
}

.line-numbers {
    width: 48px;
    background: #f5f5f5;
    color: #888;
    text-align: right;
    padding: 6px 6px 6px 0;
    user-select: none;
    overflow: hidden;
}

textarea {
    flex: 1;
    border: none;
    resize: none;
    padding: 6px;
    outline: none;
    font-family: Consolas, monospace;
    line-height: 1.6;
}

button {
    margin-top: 10px;
    padding: 8px 16px;
    font-size: 14px;
}
</style>
</head>

<body>

<h2>Import & Translate SRT</h2>
<input type="file" id="fileInput" accept=".srt">

<h3>Nội dung thoại (index hiển thị bên trái)</h3>

<div class="editor">
    <div id="lineNumbers" class="line-numbers">1</div>
    <textarea id="textOutput"
              placeholder="Hello&#10;How are you?"
              oninput="updateLineNumbers()"
              onscroll="syncScroll()"></textarea>
</div>

<button onclick="exportSRT()">Export SRT đã dịch</button>

<script>
let srtBlocks = [];

/* ===== LINE NUMBERS ===== */
function updateLineNumbers() {
    const textarea = document.getElementById('textOutput');
    const lines = textarea.value.split('\n').length || 1;
    let nums = '';
    for (let i = 1; i <= lines; i++) nums += i + '\n';
    document.getElementById('lineNumbers').textContent = nums;
}

function syncScroll() {
    document.getElementById('lineNumbers').scrollTop =
        document.getElementById('textOutput').scrollTop;
}

/* ===== IMPORT SRT ===== */
document.getElementById('fileInput').addEventListener('change', e => {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = () => parseSRT(reader.result);
    reader.readAsText(file, 'UTF-8');
});

function parseSRT(content) {
    srtBlocks = [];
    let dialogues = [];

    content.replace(/\r/g, '').split('\n\n').forEach(block => {
        const lines = block.split('\n');
        if (lines.length < 3) return;

        const index = lines[0];
        const timeline = lines[1];
        const texts = lines.slice(2);

        texts.forEach(text => {
            srtBlocks.push({ index, timeline });
            dialogues.push(text);
        });
    });

    const textarea = document.getElementById('textOutput');
    textarea.value = dialogues.join('\n');
    updateLineNumbers();
}

/* ===== EXPORT SRT ===== */
function exportSRT() {
    const lines = document.getElementById('textOutput').value.split('\n');

    if (lines.length !== srtBlocks.length) {
        alert('Số dòng không khớp!');
        return;
    }

    let out = '';
    lines.forEach((text, i) => {
        out += (i + 1) + '\n';
        out += srtBlocks[i].timeline + '\n';
        out += text + '\n\n';
    });

    const blob = new Blob([out], { type: 'text/plain;charset=utf-8' });
    const url = URL.createObjectURL(blob);
    Object.assign(document.createElement('a'), {
        href: url,
        download: 'translated.srt'
    }).click();
    URL.revokeObjectURL(url);
}

updateLineNumbers();
</script>

</body>
</html>
